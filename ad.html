<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Login | Bus Party Ambassadors</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #0b4d2b 0%, #1a7d42 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .login-container { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); width: 100%; max-width: 400px; overflow: hidden; }
    .login-header { background: #0b4d2b; color: #f5c400; padding: 25px; text-align: center; }
    .login-header h1 { font-size: 24px; margin-bottom: 5px; }
    .login-header p { font-size: 14px; opacity: 0.9; }
    .login-form { padding: 30px; }
    .input-group { margin-bottom: 20px; }
    .input-group label { display: block; color: #0b4d2b; font-weight: bold; margin-bottom: 8px; font-size: 14px; }
    .input-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
    .input-group input:focus { border-color: #0b4d2b; outline: none; }
    .login-btn { background: #0b4d2b; color: white; border: none; padding: 14px; width: 100%; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
    .login-btn:hover { background: #1a7d42; }
    .login-btn:disabled { background: #ccc; cursor: not-allowed; }
    .message { margin-top: 15px; padding: 12px; border-radius: 8px; text-align: center; font-size: 14px; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    .setup-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center; }
    .setup-warning a { color: #0b4d2b; font-weight: bold; text-decoration: none; }
    .setup-warning a:hover { text-decoration: underline; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-header">
      <h1>Admin Login</h1>
      <p>Bus Party Ambassadors Administration Panel</p>
    </div>
    
    <div class="login-form">
      <div id="setupWarning" class="setup-warning">
        <strong>⚠️ Only Admin are Allowed</strong>
        
        
      </div>
      
      <div id="loginSection">
        <div class="input-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" placeholder="admin@example.com" autocomplete="username" />
        </div>
        
        <div class="input-group">
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="••••••••" autocomplete="current-password" />
        </div>
        
        <button id="loginBtn" class="login-btn">Login</button>
        
        <div id="loginMessage" class="message hidden"></div>
        
        <div class="info message" style="margin-top: 20px;">
          <strong>Note:</strong> Account creation is disabled. Contact system administrator for access.
        </div>
      </div>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC1zqdQ4toWB73hpxn-LwIRbB2QI3fw8q8",
      authDomain: "bus-party.firebaseapp.com",
      projectId: "bus-party",
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM Elements
    const setupWarning = document.getElementById('setupWarning');
    const loginSection = document.getElementById('loginSection');
    const loginBtn = document.getElementById('loginBtn');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginMessage = document.getElementById('loginMessage');

    // Check if any admin accounts exist
    async function checkAdminAccounts() {
      try {
        const snapshot = await db.collection('users')
          .where('role', 'in', ['admin', 'editor'])
          .limit(1)
          .get();
        
        if (snapshot.empty) {
          // No admin accounts found - show setup warning
          setupWarning.classList.remove('hidden');
          loginSection.classList.add('hidden');
          return false;
        } else {
          // Admin accounts exist - show login form
          setupWarning.classList.add('hidden');
          loginSection.classList.remove('hidden');
          return true;
        }
      } catch (error) {
        console.error("Error checking admin accounts:", error);
        return false;
      }
    }

    // Show message
    function showLoginMessage(text, type = 'error') {
      loginMessage.textContent = text;
      loginMessage.className = `message ${type}`;
      loginMessage.classList.remove('hidden');
    }

    // Hide message
    function hideLoginMessage() {
      loginMessage.classList.add('hidden');
    }

    // Login function
    async function login() {
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      // Validation
      if (!email || !password) {
        showLoginMessage('Please enter email and password', 'error');
        return;
      }

      loginBtn.disabled = true;
      loginBtn.textContent = 'Logging in...';
      hideLoginMessage();

      try {
        // Sign in with email and password
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Check user role in Firestore
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (!userDoc.exists) {
          throw new Error('User account not found in database');
        }
        
        const userData = userDoc.data();
        
        // Check if user has admin/editor role
        if (userData.role !== 'admin' && userData.role !== 'editor') {
          await auth.signOut();
          showLoginMessage('Access denied: Insufficient permissions', 'error');
          return;
        }
        
        // Update last login timestamp
        await db.collection('users').doc(user.uid).update({
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Redirect to dashboard
        window.location.href = 'dashboard.html';
        
      } catch (error) {
        console.error('Login error:', error);
        
        let errorMessage = 'Login failed: ';
        switch (error.code) {
          case 'auth/user-not-found':
            errorMessage += 'User not found';
            break;
          case 'auth/wrong-password':
            errorMessage += 'Incorrect password';
            break;
          case 'auth/user-disabled':
            errorMessage += 'Account disabled';
            break;
          case 'auth/too-many-requests':
            errorMessage += 'Too many attempts. Try again later';
            break;
          default:
            errorMessage += error.message;
        }
        
        showLoginMessage(errorMessage, 'error');
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'Login';
      }
    }

    // Event Listeners
    loginBtn.addEventListener('click', login);
    
    // Allow login with Enter key
    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        login();
      }
    });

    // Check admin accounts on page load
    checkAdminAccounts();
  </script>
</body>
          </html>
